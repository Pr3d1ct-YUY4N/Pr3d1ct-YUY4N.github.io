
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <title>题目杂记 | Pr3d1ct</title>
    <meta name="author" content="Pr3d1ct" />
    <meta name="description" content="一个菜菜的密码手" />
    <meta name="keywords" content="love" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/avatar.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>PR3D1CT</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-home fa-fw"></i>
            <span>&ensp;主页</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;关于</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;归档</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;类别</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;标签</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;PR3D1CT</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-home fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">主页</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">关于</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">归档</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">类别</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">标签</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    <div>
        <h1>题目杂记</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/11/28
        </span>
        
        
    </div>
    
    <div class="content" v-pre>
        <p>之前打过的比赛一直没更，有些懒，这次全更了。<br>ps：星盟安全团队密码招新</p>
<span id="more"></span>

<h1 id="巅峰极客-Crypto"><a href="#巅峰极客-Crypto" class="headerlink" title="巅峰极客-Crypto"></a>巅峰极客-Crypto</h1><p>task.py</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line">from ecdsa.ecdsa import *</span><br><span class="line">from Crypto.Util.number import *</span><br><span class="line">import hashlib</span><br><span class="line">import gmpy2</span><br><span class="line"></span><br><span class="line">def inverse_mod(a, m):</span><br><span class="line">    if a == 0:</span><br><span class="line">        return 0</span><br><span class="line">    return gmpy2.powmod(a, -1, m)</span><br><span class="line"></span><br><span class="line">def bit_length(x):</span><br><span class="line">    return x.bit_length()</span><br><span class="line"></span><br><span class="line">def get_malicious_key():</span><br><span class="line">    a = getRandomNBitInteger(20)</span><br><span class="line">    b = getRandomNBitInteger(21)</span><br><span class="line">    w = getRandomNBitInteger(30)</span><br><span class="line">    X = getRandomNBitInteger(25)</span><br><span class="line">    return a, b, w, X</span><br><span class="line"></span><br><span class="line">class RSZeroError(RuntimeError):</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class InvalidPointError(RuntimeError):</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Signature(object):</span><br><span class="line">    &quot;&quot;&quot;ECDSA signature.&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self, r, s):</span><br><span class="line">        self.r = r</span><br><span class="line">        self.s = s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Public_key(object):</span><br><span class="line">    &quot;&quot;&quot;Public key for ECDSA.&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self, generator, point, verify=True):</span><br><span class="line"></span><br><span class="line">        self.curve = generator.curve()</span><br><span class="line">        self.generator = generator</span><br><span class="line">        self.point = point</span><br><span class="line">        n = generator.order()</span><br><span class="line">        p = self.curve.p()</span><br><span class="line">        if not (0 &lt;= point.x() &lt; p) or not (0 &lt;= point.y() &lt; p):</span><br><span class="line">            raise InvalidPointError(</span><br><span class="line">                &quot;The public point has x or y out of range.&quot;</span><br><span class="line">            )</span><br><span class="line">        if verify and not self.curve.contains_point(point.x(), point.y()):</span><br><span class="line">            raise InvalidPointError(&quot;Point does not lay on the curve&quot;)</span><br><span class="line">        if not n:</span><br><span class="line">            raise InvalidPointError(&quot;Generator point must have order.&quot;)</span><br><span class="line"></span><br><span class="line">        if (</span><br><span class="line">            verify</span><br><span class="line">            and self.curve.cofactor() != 1</span><br><span class="line">            and not n * point == ellipticcurve.INFINITY</span><br><span class="line">        ):</span><br><span class="line">            raise InvalidPointError(&quot;Generator point order is bad.&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Private_key(object):</span><br><span class="line">    &quot;&quot;&quot;Private key for ECDSA.&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self, public_key, secret_multiplier):</span><br><span class="line"></span><br><span class="line">        self.public_key = public_key</span><br><span class="line">        self.secret_multiplier = secret_multiplier</span><br><span class="line"></span><br><span class="line">    def sign(self, hash, random_k):</span><br><span class="line"></span><br><span class="line">        G = self.public_key.generator</span><br><span class="line">        n = G.order()</span><br><span class="line">        k = random_k % n</span><br><span class="line">        p1 = k * G</span><br><span class="line">        r = p1.x() % n</span><br><span class="line">        if r == 0:</span><br><span class="line">            raise RSZeroError(&quot;amazingly unlucky random number r&quot;)</span><br><span class="line">        s = (</span><br><span class="line">            inverse_mod(k, n)</span><br><span class="line">            * (hash + (self.secret_multiplier * r) % n)</span><br><span class="line">        ) % n</span><br><span class="line">        if s == 0:</span><br><span class="line">            raise RSZeroError(&quot;amazingly unlucky random number s&quot;)</span><br><span class="line">        return Signature(r, s)</span><br><span class="line"></span><br><span class="line">    def malicious_sign(self,hash, random_k, a, b, w, X):</span><br><span class="line">        # t = random.randint(0,1)</span><br><span class="line">        t = 1</span><br><span class="line">        G = self.public_key.generator</span><br><span class="line">        Y = X * G</span><br><span class="line">        n = G.order()</span><br><span class="line">        k1 = random_k</span><br><span class="line">        z = (k1 - w * t) * G + (-a * k1 - b) * Y</span><br><span class="line">        zx = z.x() % n</span><br><span class="line">        k2 = int(hashlib.sha1(str(zx).encode()).hexdigest(), 16)</span><br><span class="line">        #print(f&#x27;k2 = &#123;k2&#125;&#x27;)</span><br><span class="line">        p1 = k2 * G</span><br><span class="line">        r = p1.x() % n</span><br><span class="line">        if r == 0:</span><br><span class="line">            raise RSZeroError(&quot;amazingly unlucky random number r&quot;)</span><br><span class="line">        s = (</span><br><span class="line">                    inverse_mod(k2, n)</span><br><span class="line">                    * (hash + (self.secret_multiplier * r) % n)</span><br><span class="line">            ) % n</span><br><span class="line">        if s == 0:</span><br><span class="line">            raise RSZeroError(&quot;amazingly unlucky random number s&quot;)</span><br><span class="line">        return (Signature(r, s),k2)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    a,b,w,X = get_malicious_key()</span><br><span class="line">   </span><br><span class="line">    message1 = b&#x27;It sounds as though you were lamenting,&#x27;</span><br><span class="line">    message2 = b&#x27;a butterfly cooing like a dove.&#x27;</span><br><span class="line">    hash_message1 = int(hashlib.sha1(message1).hexdigest(), 16)</span><br><span class="line">    hash_message2 = int(hashlib.sha1(message2).hexdigest(), 16)</span><br><span class="line">    private = getRandomNBitInteger(50)</span><br><span class="line">    rand = getRandomNBitInteger(49)</span><br><span class="line">    public_key = Public_key(generator_192, generator_192 * private)</span><br><span class="line">    private_key = Private_key(public_key, private)</span><br><span class="line">    sig = private_key.sign(hash_message1, rand)</span><br><span class="line">    malicious_sig,k2 = private_key.malicious_sign(hash_message2, rand, a,b,w,X)</span><br><span class="line">    </span><br><span class="line">    print(a,b,w,X)</span><br><span class="line">    print(sig.r)</span><br><span class="line">    print(malicious_sig.r)</span><br><span class="line"></span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    751818 1155982 908970521 20391992</span><br><span class="line">    6052579169727414254054653383715281797417510994285530927615</span><br><span class="line">    3839784391338849056467977882403235863760503590134852141664</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    </span><br><span class="line">    # flag为flag&#123;uuid&#125;格式</span><br><span class="line">    flag = b&#x27;&#x27;</span><br><span class="line">    m = bytes_to_long(flag)</span><br><span class="line">    p = k2</span><br><span class="line">    for i in range(99):</span><br><span class="line">        p = gmpy2.next_prime(p)</span><br><span class="line">    q = gmpy2.next_prime(p)</span><br><span class="line">    e = 65537</span><br><span class="line">    c = pow(m,e,p*q)</span><br><span class="line">    print(c)</span><br><span class="line">    # 1294716523385880392710224476578009870292343123062352402869702505110652244504101007338338248714943</span><br></pre></td></tr></table></figure>

<p>分析题目</p>
<p>首先可以很明显地看到题目是ECDSA，那么就先讲一下ECDSA呢</p>
<h2 id="ECDSA"><a href="#ECDSA" class="headerlink" title="ECDSA"></a>ECDSA</h2><p><font style="color:rgb(51, 51, 51);">椭圆曲线数字签名算法英语：Elliptic Curve Digital Signature Algorithm，缩写：ECDSA）是一种基于椭圆曲线密码学的公开密钥的加密算法，在之前的对于DSA知识点的文章介绍里面提到过ECDSA，ECDSA就是他的一个变种，Alice和Bob仍然使用同样的曲线，ECDSA需要使用明文的哈希结果，而不是明文本身。哈希函数的选择取决于使用者，但是需要明确的是必须选择加密安全的哈希函数。</font></p>
<p>因为ECDSA是签名算法，所以下面是签名和验签的过程</p>
<h3 id="签名"><a href="#签名" class="headerlink" title="签名"></a>签名</h3><p>1、需要选择一条椭圆曲线Ep(a,b)</p>
<p>2、选取一个随机数k，使	其范围满足1&lt;k&lt;&#x3D;n-1,n则是椭圆曲线的阶</p>
<p>3、选取椭圆曲线上任意点G，计算K&#x3D;k*G,坐标为K&#x3D;(x,y)(注意这里的x,y为点K的x,y)</p>
<p>4、计算数字r&#x3D;xK mod n</p>
<p>5、如果r&#x3D;0，那么签名失败重新选择k直到其不等于0</p>
<p>6、获取要加密的明文m的哈希值Hex(m)，计算根据，s<em>k&#x3D;(Hex(m)+r</em>d)mod n(此处为Alice的私钥d)</p>
<p>7、如果s&#x3D;0，那么重新选择k，重新计算</p>
<p>8、输出签名(r,s)</p>
<h3 id="验签"><a href="#验签" class="headerlink" title="验签"></a>验签</h3><p>1、计算u1&#x3D;s**(-1)*z mod n </p>
<p>2、就算u2&#x3D;s**(-1)*r mod n</p>
<p>3、计算P&#x3D;u1<em>G+u2</em>H(A)&#x3D; (s**(-1)<em>z</em>G+s**(-1)<em>r</em>H(A)) mod n &#x3D;s**(-1)<em>G(z+r</em>d)mod n (此处d为Alice的私钥)</p>
<p>4、当r&#x3D;xP mod n的时候，验签成功</p>
<h2 id="分析代码"><a href="#分析代码" class="headerlink" title="分析代码"></a>分析代码</h2><h3 id="主代码"><a href="#主代码" class="headerlink" title="主代码"></a>主代码</h3><p>那我们了解完签名与验签的过程可以来分析题目，先看主函数程序运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    a,b,w,X = get_malicious_key()</span><br><span class="line">   </span><br><span class="line">    message1 = b&#x27;It sounds as though you were lamenting,&#x27;</span><br><span class="line">    message2 = b&#x27;a butterfly cooing like a dove.&#x27;</span><br><span class="line">    hash_message1 = int(hashlib.sha1(message1).hexdigest(), 16)</span><br><span class="line">    hash_message2 = int(hashlib.sha1(message2).hexdigest(), 16)</span><br><span class="line">    private = getRandomNBitInteger(50)</span><br><span class="line">    rand = getRandomNBitInteger(49)</span><br><span class="line">    public_key = Public_key(generator_192, generator_192 * private)</span><br><span class="line">    private_key = Private_key(public_key, private)</span><br><span class="line">    sig = private_key.sign(hash_message1, rand)</span><br><span class="line">    malicious_sig,k2 = private_key.malicious_sign(hash_message2, rand, a,b,w,X)</span><br><span class="line">    </span><br><span class="line">    print(a,b,w,X)</span><br><span class="line">    print(sig.r)</span><br><span class="line">    print(malicious_sig.r)</span><br><span class="line"></span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    751818 1155982 908970521 20391992</span><br><span class="line">    6052579169727414254054653383715281797417510994285530927615</span><br><span class="line">    3839784391338849056467977882403235863760503590134852141664</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    </span><br><span class="line">    # flag为flag&#123;uuid&#125;格式</span><br><span class="line">    flag = b&#x27;&#x27;</span><br><span class="line">    m = bytes_to_long(flag)</span><br><span class="line">    p = k2</span><br><span class="line">    for i in range(99):</span><br><span class="line">        p = gmpy2.next_prime(p)</span><br><span class="line">    q = gmpy2.next_prime(p)</span><br><span class="line">    e = 65537</span><br><span class="line">    c = pow(m,e,p*q)</span><br><span class="line">    print(c)</span><br><span class="line">    # 1294716523385880392710224476578009870292343123062352402869702505110652244504101007338338248714943</span><br></pre></td></tr></table></figure>

<p>在这里面我们可以看到首先给定了Alice和Bob传递的明文，然后生成两个签名，并且用第二个签名生成p与q然后生成一个rsa</p>
<p>接下来逐步分析两个签名</p>
<h3 id="签名一"><a href="#签名一" class="headerlink" title="签名一"></a>签名一</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">def sign(self, hash, random_k):</span><br><span class="line"></span><br><span class="line">    G = self.public_key.generator</span><br><span class="line">    n = G.order()</span><br><span class="line">    k = random_k % n</span><br><span class="line">    p1 = k * G</span><br><span class="line">    r = p1.x() % n</span><br><span class="line">    if r == 0:</span><br><span class="line">        raise RSZeroError(&quot;amazingly unlucky random number r&quot;)</span><br><span class="line">    s = (</span><br><span class="line">        inverse_mod(k, n)</span><br><span class="line">        * (hash + (self.secret_multiplier * r) % n)</span><br><span class="line">    ) % n</span><br><span class="line">    if s == 0:</span><br><span class="line">        raise RSZeroError(&quot;amazingly unlucky random number s&quot;)</span><br><span class="line">    return Signature(r, s)</span><br></pre></td></tr></table></figure>

<p>在这个签名，就是正常流程，不多做赘述</p>
<h3 id="签名二"><a href="#签名二" class="headerlink" title="签名二"></a>签名二</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">def malicious_sign(self,hash, random_k, a, b, w, X):</span><br><span class="line">    # t = random.randint(0,1)</span><br><span class="line">    t = 1</span><br><span class="line">    G = self.public_key.generator</span><br><span class="line">    Y = X * G</span><br><span class="line">    n = G.order()</span><br><span class="line">    k1 = random_k</span><br><span class="line">    z = (k1 - w * t) * G + (-a * k1 - b) * Y</span><br><span class="line">    zx = z.x() % n</span><br><span class="line">    k2 = int(hashlib.sha1(str(zx).encode()).hexdigest(), 16)</span><br><span class="line">    #print(f&#x27;k2 = &#123;k2&#125;&#x27;)</span><br><span class="line">    p1 = k2 * G</span><br><span class="line">    r = p1.x() % n</span><br><span class="line">    if r == 0:</span><br><span class="line">        raise RSZeroError(&quot;amazingly unlucky random number r&quot;)</span><br><span class="line">    s = (</span><br><span class="line">                inverse_mod(k2, n)</span><br><span class="line">                * (hash + (self.secret_multiplier * r) % n)</span><br><span class="line">        ) % n</span><br><span class="line">    if s == 0:</span><br><span class="line">        raise RSZeroError(&quot;amazingly unlucky random number s&quot;)</span><br><span class="line">    return (Signature(r, s),k2)</span><br></pre></td></tr></table></figure>

<p>这个签名相比签名一多了一个生成z与k2的过程，我们可以知道k2就是z点的x坐标，那么我们去找到z点就可以</p>
<h3 id="后门分析"><a href="#后门分析" class="headerlink" title="后门分析"></a>后门分析</h3><p>然后根据整体代码或者自己测一下数据就可以发现，我们两个签名用的k和G是一样的，这个其实就是这道题目所说的后门了，所以我们在签名1得到的r其实就是k1*G的x坐标，但是因为这个是椭圆曲线上的点，点的相乘和正常的相乘是不一样的，所以我们就可以将式子转换为，z &#x3D; p1+( - w * t) * G + (-a * k1 - b) * Y + (-a * p1)<em>X+ (-b * X</em>G),在这里需要注意的是椭圆曲线上的点不支持减法所以需要转化为+上负数倍的，然后我们将式子带入签名一然后直接解码就好了</p>
<p>完整exp：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br></pre></td><td class="code"><pre><span class="line">from ecdsa.ecdsa import *</span><br><span class="line">from Cryptodome.Util.number import *</span><br><span class="line">import hashlib</span><br><span class="line">import gmpy2</span><br><span class="line">from tqdm import *</span><br><span class="line">import sympy</span><br><span class="line">def inverse_mod(a, m):</span><br><span class="line">    if a == 0:</span><br><span class="line">        return 0</span><br><span class="line">    return gmpy2.powmod(a, -1, m)</span><br><span class="line"></span><br><span class="line">def bit_length(x):</span><br><span class="line">    return x.bit_length()</span><br><span class="line"></span><br><span class="line">def get_malicious_key():</span><br><span class="line">    a = getRandomNBitInteger(20)</span><br><span class="line">    b = getRandomNBitInteger(21)</span><br><span class="line">    w = getRandomNBitInteger(30)</span><br><span class="line">    X = getRandomNBitInteger(25)</span><br><span class="line">    return a, b, w, X</span><br><span class="line"></span><br><span class="line">class RSZeroError(RuntimeError):</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class InvalidPointError(RuntimeError):</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Signature(object):</span><br><span class="line">    &quot;&quot;&quot;ECDSA signature.&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self, r, s):</span><br><span class="line">        self.r = r</span><br><span class="line">        self.s = s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Public_key(object):</span><br><span class="line">    &quot;&quot;&quot;Public key for ECDSA.&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self, generator, point, verify=True):</span><br><span class="line"></span><br><span class="line">        self.curve = generator.curve()</span><br><span class="line">        self.generator = generator</span><br><span class="line">        self.point = point</span><br><span class="line">        n = generator.order()</span><br><span class="line">        p = self.curve.p()</span><br><span class="line">        if not (0 &lt;= point.x() &lt; p) or not (0 &lt;= point.y() &lt; p):</span><br><span class="line">            raise InvalidPointError(</span><br><span class="line">                &quot;The public point has x or y out of range.&quot;</span><br><span class="line">            )</span><br><span class="line">        if verify and not self.curve.contains_point(point.x(), point.y()):</span><br><span class="line">            raise InvalidPointError(&quot;Point does not lay on the curve&quot;)</span><br><span class="line">        if not n:</span><br><span class="line">            raise InvalidPointError(&quot;Generator point must have order.&quot;)</span><br><span class="line"></span><br><span class="line">        if (</span><br><span class="line">            verify</span><br><span class="line">            and self.curve.cofactor() != 1</span><br><span class="line">            and not n * point == ellipticcurve.INFINITY</span><br><span class="line">        ):</span><br><span class="line">            raise InvalidPointError(&quot;Generator point order is bad.&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Private_key(object):</span><br><span class="line">    &quot;&quot;&quot;Private key for ECDSA.&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self, public_key, secret_multiplier):</span><br><span class="line"></span><br><span class="line">        self.public_key = public_key</span><br><span class="line">        self.secret_multiplier = secret_multiplier</span><br><span class="line">    def change_generator(self, o):</span><br><span class="line">        # 假设 new_generator 是一个包含新生成元的元组</span><br><span class="line">        self.public_key.generator = o</span><br><span class="line"></span><br><span class="line">    def sign(self, hash, random_k):</span><br><span class="line"></span><br><span class="line">        G = self.public_key.generator</span><br><span class="line">        print(G)</span><br><span class="line"></span><br><span class="line">        n = G.order()</span><br><span class="line">        print(&#x27;-------&#x27;)</span><br><span class="line">        print(&#x27;G&#x27;,G.x())</span><br><span class="line">        k = 432179965122662 % n</span><br><span class="line">        p1 = k * G</span><br><span class="line">        print(k)</span><br><span class="line">        print(&#x27;random_k&#x27;,random_k)</span><br><span class="line">        print(&#x27;o&#x27;,p1.x())</span><br><span class="line">        print(p1)</span><br><span class="line">        print(p1.y())</span><br><span class="line">        print(&#x27;n&#x27;,n)</span><br><span class="line">        r = p1.x() % n</span><br><span class="line">        print(n)</span><br><span class="line">        print(&#x27;-----------------&#x27;)</span><br><span class="line">        a = 751818</span><br><span class="line">        b = 1155982</span><br><span class="line">        w = 908970521</span><br><span class="line">        X = 20391992</span><br><span class="line">        t=1</span><br><span class="line">        z = p1+(-w * t) * G + (-a * p1)*X+ (-b * X*G)</span><br><span class="line">        print(z)</span><br><span class="line">        print(&#x27;z&#x27;, z.x())</span><br><span class="line">        print(&#x27;z&#x27;, z.y())</span><br><span class="line">        zx = z.x() % n</span><br><span class="line">        print(&#x27;zx&#x27;, zx)</span><br><span class="line">        k2 = int(hashlib.sha1(str(zx).encode()).hexdigest(), 16)</span><br><span class="line">        print(&#x27;k2&#x27;, k2)</span><br><span class="line">        print(&quot;k2&quot;, k2, k2.bit_length(), hashlib.sha1(str(zx).encode()).hexdigest(),</span><br><span class="line">              len(hashlib.sha1(str(zx).encode()).hexdigest()))</span><br><span class="line">        # print(f&#x27;k2 = &#123;k2&#125;&#x27;)</span><br><span class="line"></span><br><span class="line">        print(&#x27;=========================================================&#x27;)</span><br><span class="line">        #     k2 = int(hashlib.sha1(str(zx).encode()).hexdigest(), 16)</span><br><span class="line">        p = k2</span><br><span class="line">        for i in range(99):</span><br><span class="line">            p = sympy.nextprime(p)</span><br><span class="line">        q = sympy.nextprime(p)</span><br><span class="line">        e = 65537</span><br><span class="line">        d = inverse(e, (p - 1) * (q - 1))</span><br><span class="line">        c = 1294716523385880392710224476578009870292343123062352402869702505110652244504101007338338248714943</span><br><span class="line">        n = p * q</span><br><span class="line">        m = int(pow(c, d, n))</span><br><span class="line">        for i in range(2 ** 16):</span><br><span class="line">            m += n</span><br><span class="line">            flag = long_to_bytes(int(m))</span><br><span class="line">            if b&quot;flag&quot; in flag:</span><br><span class="line">                print(i)</span><br><span class="line">                print(flag)</span><br><span class="line">                break</span><br><span class="line"></span><br><span class="line">        print(&#x27;-----&#x27;)</span><br><span class="line"></span><br><span class="line">        if r == 0:</span><br><span class="line">            raise RSZeroError(&quot;amazingly unlucky random number r&quot;)</span><br><span class="line">        s = (</span><br><span class="line">            inverse_mod(k, n)</span><br><span class="line">            * (hash + (self.secret_multiplier * r) % n)</span><br><span class="line">        ) % n</span><br><span class="line">        if s == 0:</span><br><span class="line">            raise RSZeroError(&quot;amazingly unlucky random number s&quot;)</span><br><span class="line">        return Signature(r, s)</span><br><span class="line"></span><br><span class="line">    def malicious_sign(self,hash, random_k, a, b, w, X):</span><br><span class="line">        # t = random.randint(0,1)</span><br><span class="line">        t = 1</span><br><span class="line">        G = self.public_key.generator</span><br><span class="line">        print(G.x())</span><br><span class="line">        print(G.y())</span><br><span class="line">        print(&#x27;random_k&#x27;, random_k)</span><br><span class="line">        print(&#x27;G&#x27;,G.x())</span><br><span class="line">        Y = X * G</span><br><span class="line">        print(&#x27;Y&#x27;,Y.x())</span><br><span class="line">        print(&#x27;Y&#x27;, Y.y())</span><br><span class="line">        n = G.order()</span><br><span class="line">        print(&#x27;n&#x27;,n)</span><br><span class="line">        k1 = random_k</span><br><span class="line">        z = (k1 - w * t) * G + (-a * k1 - b) * Y</span><br><span class="line">        print(z)</span><br><span class="line">        print(&#x27;z&#x27;,z.x())</span><br><span class="line">        print(&#x27;z&#x27;,z.y())</span><br><span class="line">        zx = z.x() % n</span><br><span class="line">        print(&#x27;zx&#x27;,zx)</span><br><span class="line">        k2 = int(hashlib.sha1(str(zx).encode()).hexdigest(), 16)</span><br><span class="line">        print(&#x27;k2&#x27;,k2)</span><br><span class="line">        print(&quot;k2&quot;,k2,k2.bit_length(),hashlib.sha1(str(zx).encode()).hexdigest(),len(hashlib.sha1(str(zx).encode()).hexdigest()))</span><br><span class="line">        #print(f&#x27;k2 = &#123;k2&#125;&#x27;)</span><br><span class="line">        p1 = k2 * G</span><br><span class="line">        r = p1.x() % n</span><br><span class="line">        if r == 0:</span><br><span class="line">            raise RSZeroError(&quot;amazingly unlucky random number r&quot;)</span><br><span class="line">        s = (</span><br><span class="line">                    inverse_mod(k2, n)</span><br><span class="line">                    * (hash + (self.secret_multiplier * r) % n)</span><br><span class="line">            ) % n</span><br><span class="line">        if s == 0:</span><br><span class="line">            raise RSZeroError(&quot;amazingly unlucky random number s&quot;)</span><br><span class="line">        return (Signature(r, s),k2)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">    message1 = b&#x27;It sounds as though you were lamenting,&#x27;</span><br><span class="line">    message2 = b&#x27;a butterfly cooing like a dove.&#x27;</span><br><span class="line">    hash_message1 = int(hashlib.sha1(message1).hexdigest(), 16)</span><br><span class="line">    print(&#x27;hash_message1&#x27;,hash_message1)</span><br><span class="line">    hash_message2 = int(hashlib.sha1(message2).hexdigest(), 16)</span><br><span class="line">    print(&#x27;hash_message2&#x27;, hash_message2)</span><br><span class="line">    private = getRandomNBitInteger(50)</span><br><span class="line">    print(&#x27;private&#x27;,private)</span><br><span class="line">    rand = getRandomNBitInteger(49)</span><br><span class="line">    print(&#x27;rand&#x27;,rand)</span><br><span class="line">    public_key = Public_key(generator_192, generator_192 * private)</span><br><span class="line">    private_key = Private_key(public_key, private)</span><br><span class="line">    sig = private_key.sign(hash_message1, rand)</span><br><span class="line">    a=751818</span><br><span class="line">    b=1155982</span><br><span class="line">    w=908970521</span><br><span class="line">    X=20391992</span><br><span class="line">    malicious_sig,k2 = private_key.malicious_sign(hash_message2, rand, a,b,w,X)</span><br><span class="line">    print(&#x27;malicious_sig&#x27;,malicious_sig.s)</span><br><span class="line">    print(k2)</span><br><span class="line">    </span><br><span class="line">    print(a,b,w,X)</span><br><span class="line">    print(sig.r)</span><br><span class="line">    print(malicious_sig.r)</span><br><span class="line"></span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    751818 1155982 908970521 20391992</span><br><span class="line">    6052579169727414254054653383715281797417510994285530927615</span><br><span class="line">    3839784391338849056467977882403235863760503590134852141664</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    </span><br><span class="line">    # flag为flag&#123;uuid&#125;格式</span><br><span class="line">    flag = b&#x27;aaa&#x27;</span><br><span class="line">    m = bytes_to_long(flag)</span><br><span class="line">    p = k2</span><br><span class="line">    for i in range(99):</span><br><span class="line">        p = gmpy2.next_prime(p)</span><br><span class="line">    print(p)</span><br><span class="line">    q = gmpy2.next_prime(p)</span><br><span class="line">    e = 65537</span><br><span class="line">    c = pow(m,e,p*q)</span><br><span class="line">    print(c)</span><br><span class="line">    print(long_to_bytes(1294716523385880392710224476578009870292343123062352402869702505110652244504101007338338248714943))</span><br><span class="line">    # 1294716523385880392710224476578009870292343123062352402869702505110652244504101007338338248714943</span><br><span class="line">    print(&#x27;----------------------------------------------------------&#x27;)</span><br></pre></td></tr></table></figure>



<h1 id="SEKAICTF-Crypto"><a href="#SEKAICTF-Crypto" class="headerlink" title="SEKAICTF-Crypto"></a>SEKAICTF-Crypto</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">import random</span><br><span class="line">from secrets import randbelow, randbits</span><br><span class="line">from flag import FLAG</span><br><span class="line"></span><br><span class="line">CIPHER_SUITE = randbelow(2**256)</span><br><span class="line">print(f&quot;oPUN_SASS_SASS_l version 4.0.&#123;CIPHER_SUITE&#125;&quot;)</span><br><span class="line">random.seed(CIPHER_SUITE)</span><br><span class="line"></span><br><span class="line">GSIZE = 8209</span><br><span class="line">GNUM = 79</span><br><span class="line"></span><br><span class="line">LIM = GSIZE**GNUM</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def gen(n):</span><br><span class="line">    p, i = [0] * n, 0</span><br><span class="line">    for j in random.sample(range(1, n), n - 1):</span><br><span class="line">        p[i], i = j, j</span><br><span class="line">    return tuple(p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def gexp(g, e):</span><br><span class="line">    res = tuple(g)</span><br><span class="line">    while e:</span><br><span class="line">        if e &amp; 1:</span><br><span class="line">            res = tuple(res[i] for i in g)</span><br><span class="line">        e &gt;&gt;= 1</span><br><span class="line">        g = tuple(g[i] for i in g)</span><br><span class="line">    return res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def enc(k, m, G):</span><br><span class="line">    if not G:</span><br><span class="line">        return m</span><br><span class="line">    mod = len(G[0])</span><br><span class="line">    return gexp(G[0], k % mod)[m % mod] + enc(k // mod, m // mod, G[1:]) * mod</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def inverse(perm):</span><br><span class="line">    res = list(perm)</span><br><span class="line">    for i, v in enumerate(perm):</span><br><span class="line">        res[v] = i</span><br><span class="line">    return res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">G = [gen(GSIZE) for i in range(GNUM)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">FLAG = int.from_bytes(FLAG, &#x27;big&#x27;)</span><br><span class="line">left_pad = randbits(randbelow(LIM.bit_length() - FLAG.bit_length()))</span><br><span class="line">FLAG = (FLAG &lt;&lt; left_pad.bit_length()) + left_pad</span><br><span class="line">FLAG = (randbits(randbelow(LIM.bit_length() - FLAG.bit_length()))</span><br><span class="line">        &lt;&lt; FLAG.bit_length()) + FLAG</span><br><span class="line"></span><br><span class="line">bob_key = randbelow(LIM)</span><br><span class="line">bob_encr = enc(FLAG, bob_key, G)</span><br><span class="line">print(&quot;bob says&quot;, bob_encr)</span><br><span class="line">alice_key = randbelow(LIM)</span><br><span class="line">alice_encr = enc(bob_encr, alice_key, G)</span><br><span class="line">print(&quot;alice says&quot;, alice_encr)</span><br><span class="line">bob_decr = enc(alice_encr, bob_key, [inverse(i) for i in G])</span><br><span class="line">print(&quot;bob says&quot;, bob_decr)</span><br></pre></td></tr></table></figure>
<p>分析代码，先看主体干了什么，发现FLAG被填充前后都被填充了，然后可以很快的发现生成了三段密文，分别是bob_enc,alice_enc,bob_decr,可以看到三段密文都是enc函数生成的，我们去看一下enc函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def enc(k, m, G):</span><br><span class="line">    if not G:</span><br><span class="line">        return m</span><br><span class="line">    mod = len(G[0])</span><br><span class="line">    return gexp(G[0], k % mod)[m % mod] + enc(k // mod, m // mod, G[1:]) * mod</span><br></pre></td></tr></table></figure>
<p>观察enc函数，你可以很快的发现首先它是一个递归函数，很明显有一个判断条件，就是当不在G的时候程序停止返回输出，否则他会递归，每次递归的变化如下：<br>gexp(G[0], k % mod)[m % mod] + enc(k &#x2F;&#x2F; mod, m &#x2F;&#x2F; mod, G[1:]) * mod<br>在这里面可以看到有一个gexp函数，我们去看一下这个函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def gexp(g, e):</span><br><span class="line">    res = tuple(g)</span><br><span class="line">    while e:</span><br><span class="line">        if e &amp; 1:</span><br><span class="line">            res = tuple(res[i] for i in g)</span><br><span class="line">        e &gt;&gt;= 1</span><br><span class="line">        g = tuple(g[i] for i in g)</span><br><span class="line">    return res</span><br></pre></td></tr></table></figure>
<p>显而易见你不用管这个函数，首先没随机数，根据你输入的g,e规定，这两个你都知道，所以这个就是对逆输入的G进行变换成为一个新的G，其实这个G就是一个排列，也就是S盒</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def gen(n):</span><br><span class="line">    p, i = [0] * n, 0</span><br><span class="line">    for j in random.sample(range(1, n), n - 1):</span><br><span class="line">        p[i], i = j, j</span><br><span class="line">    return tuple(p)</span><br></pre></td></tr></table></figure>
<p>然后回到前面的函数你会发现，每次递归需要找到S盒的首行某个值的索引，这里面这个值就是key mod 8209，然后每次递归得到的数据需要乘一下8209在加上S盒索引所对应的值也是就在G中所对应的值，所以我们得到的密文最后会是((((((x*8209)+y)*8209)+y)*8209)+y)……….)*8209+y，所以我们的可以根据这个把每次去到的G里面的值都得到，我们要求的就是他的索引，这个索引在enc函数是key mod 8209得到的，所以我们可以反推回去得到key，这里面有个比较关键的地方我们传入的第一个数据必须要是已知明文这样我们才能找key因为明文限制了S盒的生成<br>使用G值的脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def key_mod_8029(res):</span><br><span class="line">    s=[]</span><br><span class="line">    while (res):</span><br><span class="line">        s.append(res%8209)</span><br><span class="line">        res//=8209</span><br><span class="line">    return s</span><br></pre></td></tr></table></figure>
<p>这时候我们只需要稍微修改一下enc脚本使其变成最后加起来的东西只有这些索引就好了，不过要注意的是不要让索引值＋在递归函数前面要不然根据运算规则会先从左到右＋导致数据加多了去寻找索引就出现问题，数据就有问题了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def dec(k, res, G):</span><br><span class="line">    if not G:</span><br><span class="line">        return [0]</span><br><span class="line">    mod = len(G[0])</span><br><span class="line">    return dec(k // mod, res[1:], G[1:])+[gexp(G[0], k % mod).index(res[0])]</span><br></pre></td></tr></table></figure>
<p>然后就是恢复key，根据前面所说的规则生成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def key_replay(res):</span><br><span class="line">    a=0</span><br><span class="line">    for i in res:</span><br><span class="line">        a=a*8209+i</span><br><span class="line">    return a</span><br></pre></td></tr></table></figure>
<p>然后我们就能找到alice_key,然后我们去看bob_key,前面也说了需要知道前面的已知明文所以只能用bob_decr去解密<br>然后就知道两个key，那我们去恢复明文，这下子我们知道了key，那我们传入bob_key的话因为整体不是很大8209，我们就可以爆破一下匹配传入每次在gen函数取余传入的明文是多少</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def dec1(res,key,G):</span><br><span class="line">    a=[]</span><br><span class="line">    if not G:</span><br><span class="line">        return [0]</span><br><span class="line">    for i in range(8209):</span><br><span class="line">        if gexp(G[0],i)[key%8209]==res[0]:</span><br><span class="line">            print(i)</span><br><span class="line">            a.append(i)</span><br><span class="line">    return dec1(res[1:],key//8209 ,G[1:])</span><br></pre></td></tr></table></figure>
<p>然后用key_replay函数恢复一下就好了，不过注意下这边得到的数组需要逆向相加，因为我没递归直接返回值，而是生成一个数组，因为知道FLAG是前后有随机数中间可能会有flag在然后爆破一下找低位看到了很像flag的玩意</p>
<p>27887110439548179837945284065479407005671984418227744307030297585766676421518051725820730881303094307602205264926431534545591400990734997978646260585798939930398586856703150064008768662739131299115425991133646456082485455073198522787353032367591607142340524576787860298767828999348122114<br>b”\xbb\x89\x8b\x18\xc9\x7f\xff\xab8\xe7^V\x93MXO\xf6M\xb5;\xf7h\x11\xbd\x9ah\xa9h)&#x2F;f\xecf&amp;F\x8cf,FL,\xacL\xcc\x87,\xa6\x86g,l&amp;,f\xe6\x86L\x86F\xccG&amp;\xa6\xe6\xe7&amp;F\x8cF\xac&amp;’\x06Fff\xe7\x06\x06G\x0cfl\xac\x86\xa7,\x86\xec,\x87&amp;L\x86&#x2F;\xb7\xea\x98\x08T\xbf\xa5\xb4\x8b\xeft\xa8\xde\xdf\x00\xf2\xe9o\xce\xf3\xd1Kr\x02”<br>b”\xbb\x89\x8b\x18\xc9\x7f\xff\xab8\xe7^V\x93MXO\xf6M\xb5;\xf7h\x11\xbd\x9ah\xa9h)&#x2F;f\xecf&amp;F\x8cf,FL,\xacL\xcc\x87,\xa6\x86g,l&amp;,f\xe6\x86L\x86F\xccG&amp;\xa6\xe6\xe7&amp;F\x8cF\xac&amp;’\x06Fff\xe7\x06\x06G\x0cfl\xac\x86\xa7,\x86\xec,\x87&amp;L\x86&#x2F;\xb7\xea\x98\x08T\xbf\xa5\xb4\x8b\xeft\xa8\xde\xdf\x00\xf2\xe9o\xce\xf3\xd1Kr\x02”<br>b”]\xc4\xc5\x8cd\xbf\xff\xd5\x9cs\xaf+I\xa6\xac’\xfb&amp;\xda\x9d\xfb\xb4\x08\xde\xcd4T\xb4\x14\x97\xb3v3\x13#F3\x16#&amp;\x16V&amp;fC\x96SC3\x966\x13\x163sC&amp;C#f#\x93Sss\x93#F#V\x13\x13\x83#33s\x83\x03#\x8636VCS\x96Cv\x16C\x93&amp;C\x17\xdb\xf5L\x04*_\xd2\xdaE\xf7\xbaToo\x80yt\xb7\xe7y\xe8\xa5\xb9\x01”<br>b’.\xe2b\xc62_\xff\xea\xce9\xd7\x95\xa4\xd3V\x13\xfd\x93mN\xfd\xda\x04of\x9a<em>Z\nK\xd9\xbb\x19\x89\x91\xa3\x19\x8b\x11\x93\x0b+\x133!\xcb)\xa1\x99\xcb\x1b\t\x8b\x19\xb9\xa1\x93!\x91\xb3\x11\xc9\xa9\xb9\xb9\xc9\x91\xa3\x11\xab\t\x89\xc1\x91\x99\x99\xb9\xc1\x81\x91\xc3\x19\x9b+!\xa9\xcb!\xbb\x0b!\xc9\x93!\x8b\xed\xfa\xa6\x02\x15&#x2F;\xe9m”\xfb\xdd</em>7\xb7\xc0&lt;\xba[\xf3\xbc\xf4R\xdc\x80’<br>b’\x17q1c\x19&#x2F;\xff\xf5g\x1c\xeb\xca\xd2i\xab\t\xfe\xc9\xb6\xa7<del>\xed\x027\xb3M\x15-\x05%\xec\xdd\x8c\xc4\xc8\xd1\x8c\xc5\x88\xc9\x85\x95\x89\x99\x90\xe5\x94\xd0\xcc\xe5\x8d\x84\xc5\x8c\xdc\xd0\xc9\x90\xc8\xd9\x88\xe4\xd4\xdc\xdc\xe4\xc8\xd1\x88\xd5\x84\xc4\xe0\xc8\xcc\xcc\xdc\xe0\xc0\xc8\xe1\x8c\xcd\x95\x90\xd4\xe5\x90\xdd\x85\x90\xe4\xc9\x90\xc5\xf6\xfdS\x01\n\x97\xf4\xb6\x91}\xee\x95\x1b\xdb\xe0\x1e]-\xf9\xdez)n@’<br>b’\x0b\xb8\x98\xb1\x8c\x97\xff\xfa\xb3\x8eu\xe5i4\xd5\x84\xffd\xdbS\xbfv\x81\x1b\xd9\xa6\x8a\x96\x82\x92\xf6n\xc6bdh\xc6b\xc4d\xc2\xca\xc4\xcc\xc8r\xcahfr\xc6\xc2b\xc6nhd\xc8dl\xc4rjnnrdh\xc4j\xc2bpdffnp&#96;dp\xc6f\xca\xc8jr\xc8n\xc2\xc8rd\xc8b\xfb</del>\xa9\x80\x85K\xfa[H\xbe\xf7J\x8d\xed\xf0\x0f.\x96\xfc\xef&#x3D;\x14\xb7 ‘<br>b’\x05\xdcLX\xc6K\xff\xfdY\xc7:\xf2\xb4\x9aj\xc2\x7f\xb2m\xa9\xdf\xbb@\x8d\xec\xd3EKAI{7c124c1b2aebfd9e439ca1c742d26b9577924b5a1823378028c3ed59d7ad92d1}\xbfT\xc0B\xa5\xfd-\xa4_{\xa5F\xf6\xf8\x07\x97K<del>w\x9e\x8a[\x90’<br>b’\x02\xee&amp;,c%\xff\xfe\xac\xe3\x9dyZM5a?\xd96\xd4\xef\xdd\xa0F\xf6i\xa2\xa5\xa0\xa4\xbd\x9b\xb1\x98\x99\x1a1\x98\xb1\x190\xb2\xb132\x1c\xb2\x9a\x19\x9c\xb1\xb0\x98\xb1\x9b\x9a\x192\x19\x1b1\x1c\x9a\x9b\x9b\x9c\x99\x1a1\x1a\xb0\x98\x9c\x19\x19\x99\x9b\x9c\x18\x19\x1c1\x99\xb2\xb2\x1a\x9c\xb2\x1b\xb0\xb2\x1c\x992\x18\xbe\xdf\xaa&#96;!R\xfe\x96\xd2&#x2F;\xbd\xd2\xa3{|\x03\xcb\xa5\xbf;\xcfE-\xc8’<br>b’\x01w\x13\x161\x92\xff\xffVq\xce\xbc\xad&amp;\x9a\xb0\x9f\xec\x9bjw\xee\xd0#{4\xd1R\xd0R^\xcd\xd8\xccL\x8d\x18\xccX\x8c\x98YX\x99\x99\x0eYM\x0c\xceX\xd8LX\xcd\xcd\x0c\x99\x0c\x8d\x98\x8eMM\xcd\xceL\x8d\x18\x8dXLN\x0c\x8c\xcc\xcd\xce\x0c\x0c\x8e\x18\xcc\xd9Y\rNY\r\xd8Y\x0eL\x99\x0c_o\xd50\x10\xa9\x7fKi\x17\xde\xe9Q\xbd\xbe\x01\xe5\xd2\xdf\x9d\xe7\xa2\x96\xe4’<br>b”\xbb\x89\x8b\x18\xc9\x7f\xff\xab8\xe7^V\x93MXO\xf6M\xb5;\xf7h\x11\xbd\x9ah\xa9h)&#x2F;f\xecf&amp;F\x8cf,FL,\xacL\xcc\x87,\xa6\x86g,l&amp;,f\xe6\x86L\x86F\xccG&amp;\xa6\xe6\xe7&amp;F\x8cF\xac&amp;’\x06Fff\xe7\x06\x06G\x0cfl\xac\x86\xa7,\x86\xec,\x87&amp;L\x86&#x2F;\xb7\xea\x98\x08T\xbf\xa5\xb4\x8b\xeft\xa8\xde\xdf\x00\xf2\xe9o\xce\xf3\xd1Kr”<br>b”]\xc4\xc5\x8cd\xbf\xff\xd5\x9cs\xaf+I\xa6\xac’\xfb&amp;\xda\x9d\xfb\xb4\x08\xde\xcd4T\xb4\x14\x97\xb3v3\x13#F3\x16#&amp;\x16V&amp;fC\x96SC3\x966\x13\x163sC&amp;C#f#\x93Sss\x93#F#V\x13\x13\x83#33s\x83\x03#\x8636VCS\x96Cv\x16C\x93&amp;C\x17\xdb\xf5L\x04*_\xd2\xdaE\xf7\xbaToo\x80yt\xb7\xe7y\xe8\xa5\xb9”<br>b’.\xe2b\xc62_\xff\xea\xce9\xd7\x95\xa4\xd3V\x13\xfd\x93mN\xfd\xda\x04of\x9a<em>Z\nK\xd9\xbb\x19\x89\x91\xa3\x19\x8b\x11\x93\x0b+\x133!\xcb)\xa1\x99\xcb\x1b\t\x8b\x19\xb9\xa1\x93!\x91\xb3\x11\xc9\xa9\xb9\xb9\xc9\x91\xa3\x11\xab\t\x89\xc1\x91\x99\x99\xb9\xc1\x81\x91\xc3\x19\x9b+!\xa9\xcb!\xbb\x0b!\xc9\x93!\x8b\xed\xfa\xa6\x02\x15&#x2F;\xe9m”\xfb\xdd</em>7\xb7\xc0&lt;\xba[\xf3\xbc\xf4R\xdc’<br>b’\x17q1c\x19&#x2F;\xff\xf5g\x1c\xeb\xca\xd2i\xab\t\xfe\xc9\xb6\xa7</del>\xed\x027\xb3M\x15-\x05%\xec\xdd\x8c\xc4\xc8\xd1\x8c\xc5\x88\xc9\x85\x95\x89\x99\x90\xe5\x94\xd0\xcc\xe5\x8d\x84\xc5\x8c\xdc\xd0\xc9\x90\xc8\xd9\x88\xe4\xd4\xdc\xdc\xe4\xc8\xd1\x88\xd5\x84\xc4\xe0\xc8\xcc\xcc\xdc\xe0\xc0\xc8\xe1\x8c\xcd\x95\x90\xd4\xe5\x90\xdd\x85\x90\xe4\xc9\x90\xc5\xf6\xfdS\x01\n\x97\xf4\xb6\x91}\xee\x95\x1b\xdb\xe0\x1e]-\xf9\xdez)n’<br>b’\x0b\xb8\x98\xb1\x8c\x97\xff\xfa\xb3\x8eu\xe5i4\xd5\x84\xffd\xdbS\xbfv\x81\x1b\xd9\xa6\x8a\x96\x82\x92\xf6n\xc6bdh\xc6b\xc4d\xc2\xca\xc4\xcc\xc8r\xcahfr\xc6\xc2b\xc6nhd\xc8dl\xc4rjnnrdh\xc4j\xc2bpdffnp<code>dp\xc6f\xca\xc8jr\xc8n\xc2\xc8rd\xc8b\xfb~\xa9\x80\x85K\xfa[H\xbe\xf7J\x8d\xed\xf0\x0f.\x96\xfc\xef=\x14\xb7&#39; b&#39;\x05\xdcLX\xc6K\xff\xfdY\xc7:\xf2\xb4\x9aj\xc2\x7f\xb2m\xa9\xdf\xbb@\x8d\xec\xd3EKAI&#123;7c124c1b2aebfd9e439ca1c742d26b9577924b5a1823378028c3ed59d7ad92d1&#125;\xbfT\xc0B\xa5\xfd-\xa4_&#123;\xa5F\xf6\xf8\x07\x97K~w\x9e\x8a[&#39; b&#39;\x02\xee&amp;,c%\xff\xfe\xac\xe3\x9dyZM5a?\xd96\xd4\xef\xdd\xa0F\xf6i\xa2\xa5\xa0\xa4\xbd\x9b\xb1\x98\x99\x1a1\x98\xb1\x190\xb2\xb132\x1c\xb2\x9a\x19\x9c\xb1\xb0\x98\xb1\x9b\x9a\x192\x19\x1b1\x1c\x9a\x9b\x9b\x9c\x99\x1a1\x1a\xb0\x98\x9c\x19\x19\x99\x9b\x9c\x18\x19\x1c1\x99\xb2\xb2\x1a\x9c\xb2\x1b\xb0\xb2\x1c\x992\x18\xbe\xdf\xaa</code>!R\xfe\x96\xd2&#x2F;\xbd\xd2\xa3{|\x03\xcb\xa5\xbf;\xcfE-‘<br>b’\x01w\x13\x161\x92\xff\xffVq\xce\xbc\xad&amp;\x9a\xb0\x9f\xec\x9bjw\xee\xd0#{4\xd1R\xd0R^\xcd\xd8\xccL\x8d\x18\xccX\x8c\x98YX\x99\x99\x0eYM\x0c\xceX\xd8LX\xcd\xcd\x0c\x99\x0c\x8d\x98\x8eMM\xcd\xceL\x8d\x18\x8dXLN\x0c\x8c\xcc\xcd\xce\x0c\x0c\x8e\x18\xcc\xd9Y\rNY\r\xd8Y\x0eL\x99\x0c_o\xd50\x10\xa9\x7fKi\x17\xde\xe9Q\xbd\xbe\x01\xe5\xd2\xdf\x9d\xe7\xa2\x96’<br>b”\xbb\x89\x8b\x18\xc9\x7f\xff\xab8\xe7^V\x93MXO\xf6M\xb5;\xf7h\x11\xbd\x9ah\xa9h)&#x2F;f\xecf&amp;F\x8cf,FL,\xacL\xcc\x87,\xa6\x86g,l&amp;,f\xe6\x86L\x86F\xccG&amp;\xa6\xe6\xe7&amp;F\x8cF\xac&amp;’\x06Fff\xe7\x06\x06G\x0cfl\xac\x86\xa7,\x86\xec,\x87&amp;L\x86&#x2F;\xb7\xea\x98\x08T\xbf\xa5\xb4\x8b\xeft\xa8\xde\xdf\x00\xf2\xe9o\xce\xf3\xd1K”<br>b”]\xc4\xc5\x8cd\xbf\xff\xd5\x9cs\xaf+I\xa6\xac’\xfb&amp;\xda\x9d\xfb\xb4\x08\xde\xcd4T\xb4\x14\x97\xb3v3\x13#F3\x16#&amp;\x16V&amp;fC\x96SC3\x966\x13\x163sC&amp;C#f#\x93Sss\x93#F#V\x13\x13\x83#33s\x83\x03#\x8636VCS\x96Cv\x16C\x93&amp;C\x17\xdb\xf5L\x04*_\xd2\xdaE\xf7\xbaToo\x80yt\xb7\xe7y\xe8\xa5”<br>b’.\xe2b\xc62_\xff\xea\xce9\xd7\x95\xa4\xd3V\x13\xfd\x93mN\xfd\xda\x04of\x9a<em>Z\nK\xd9\xbb\x19\x89\x91\xa3\x19\x8b\x11\x93\x0b+\x133!\xcb)\xa1\x99\xcb\x1b\t\x8b\x19\xb9\xa1\x93!\x91\xb3\x11\xc9\xa9\xb9\xb9\xc9\x91\xa3\x11\xab\t\x89\xc1\x91\x99\x99\xb9\xc1\x81\x91\xc3\x19\x9b+!\xa9\xcb!\xbb\x0b!\xc9\x93!\x8b\xed\xfa\xa6\x02\x15&#x2F;\xe9m”\xfb\xdd</em>7\xb7\xc0&lt;\xba[\xf3\xbc\xf4R’<br>b’\x17q1c\x19&#x2F;\xff\xf5g\x1c\xeb\xca\xd2i\xab\t\xfe\xc9\xb6\xa7~\xed\x027\xb3M\x15-\x05%\xec\xdd\x8c\xc4\xc8\xd1\x8c\xc5\x88\xc9\x85\x95\x89\x99\x90\xe5\x94\xd0\xcc\xe5\x8d\x84\xc5\x8c\xdc\xd0\xc9\x90\xc8\xd9\x88\xe4\xd4\xdc\xdc\xe4\xc8\xd1\x88\xd5\x84\xc4\xe0\xc8\xcc\xcc\xdc\xe0\xc0\xc8\xe1\x8c\xcd\x95\x90\xd4\xe5\x90\xdd\x85\x90\xe4\xc9\x90\xc5\xf6\xfdS\x01\n\x97\xf4\xb6\x91}\xee\x95\x1b\xdb\xe0\x1e]-\xf9\xdez)’</p>
<p>进程已结束,退出代码0</p>
<p>完整exp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line">import random</span><br><span class="line">from secrets import randbelow, randbits</span><br><span class="line">from Cryptodome.Util.number import *</span><br><span class="line"></span><br><span class="line">CIPHER_SUITE =5856735718192672966225212630546045665679020834917236661169743409360745081692</span><br><span class="line">b1 =934535015385784972098018441829301227888268300482554572889937663972835689477317906590269550483816058279675056740632836110427165342116825918458562882459952965524045087097428340305468008069307089535207656651490741013829130388943184449967876591696491662942908809195857190028729699667883172408778919813286215678587</span><br><span class="line"></span><br><span class="line">a1 =1200023343219513263382590595000530709398044680494887232151068706332454900457993992785528158990834544878450058108341045830600802696148032561205251770283666006973167393948548197072049425715808993347674584378538883200268601390915839644385525216204736891481357328537881870321049952052453132654798693784947466776387</span><br><span class="line"></span><br><span class="line">b2 =1272441200473454987001701625665347128998267676768270586334850447786321082063417203439895347670890554611411858488237562330644466912578982684875984076535384996939506416271097344882332314135242565253987938022938597663163369675849841691494448925864719322424546037485802787986584090093449519504693373904532207187504</span><br><span class="line"></span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">bob says 934535015385784972098018441829301227888268300482554572889937663972835689477317906590269550483816058279675056740632836110427165342116825918458562882459952965524045087097428340305468008069307089535207656651490741013829130388943184449967876591696491662942908809195857190028729699667883172408778919813286215678587</span><br><span class="line">alice says 1200023343219513263382590595000530709398044680494887232151068706332454900457993992785528158990834544878450058108341045830600802696148032561205251770283666006973167393948548197072049425715808993347674584378538883200268601390915839644385525216204736891481357328537881870321049952052453132654798693784947466776387</span><br><span class="line">bob says 1272441200473454987001701625665347128998267676768270586334850447786321082063417203439895347670890554611411858488237562330644466912578982684875984076535384996939506416271097344882332314135242565253987938022938597663163369675849841691494448925864719322424546037485802787986584090093449519504693373904532207187504</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">random.seed(CIPHER_SUITE)</span><br><span class="line">GSIZE = 8209</span><br><span class="line">GNUM = 79</span><br><span class="line">LIM = GSIZE ** GNUM</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def gen(n):</span><br><span class="line">    p, i = [0] * n, 0</span><br><span class="line">    for j in random.sample(range(1, n), n - 1):</span><br><span class="line">        p[i], i = j, j</span><br><span class="line">    return tuple(p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def gexp(g, e):</span><br><span class="line">    res = tuple(g)</span><br><span class="line">    while e:</span><br><span class="line">        if e &amp; 1:</span><br><span class="line">            res = tuple(res[i] for i in g)</span><br><span class="line">        e &gt;&gt;= 1</span><br><span class="line">        g = tuple(g[i] for i in g)</span><br><span class="line">    return res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def dec(k, res, G):</span><br><span class="line">    if not G:</span><br><span class="line">        return [0]</span><br><span class="line">    mod = len(G[0])</span><br><span class="line">    return dec(k // mod, res[1:], G[1:])+[gexp(G[0], k % mod).index(res[0])]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def inverse(perm):</span><br><span class="line">    res = list(perm)</span><br><span class="line">    for i, v in enumerate(perm):</span><br><span class="line">        res[v] = i</span><br><span class="line">    return res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">G = [gen(GSIZE) for i in range(GNUM)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def key_mod_8029(res):</span><br><span class="line">    a=[]</span><br><span class="line">    while (res):</span><br><span class="line">        a.append(res%8209)</span><br><span class="line">        res//=8209</span><br><span class="line">    return a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def key_replay(res):</span><br><span class="line">    a=0</span><br><span class="line">    for i in res:</span><br><span class="line">        a=a*8209+i</span><br><span class="line">    return a</span><br><span class="line"></span><br><span class="line">def dec1(res,key,G):</span><br><span class="line">    a=[]</span><br><span class="line">    if not G:</span><br><span class="line">        return [0]</span><br><span class="line">    for i in range(8209):</span><br><span class="line">        if gexp(G[0],i)[key%8209]==res[0]:</span><br><span class="line">            print(i)</span><br><span class="line">            a.append(i)</span><br><span class="line">    return dec1(res[1:],key//8209 ,G[1:])</span><br><span class="line"></span><br><span class="line">res = key_mod_8029(a1)</span><br><span class="line">alice_key = key_replay(dec(b1, res, G))</span><br><span class="line">res = key_mod_8029(b2)</span><br><span class="line">bob_key = key_replay(dec(a1, res, [inverse(i) for i in G]))</span><br><span class="line">res = key_mod_8029(b1)</span><br><span class="line">dec1(res, bob_key, G)</span><br><span class="line">a=(1936,</span><br><span class="line">714,</span><br><span class="line">7902,</span><br><span class="line">2862,</span><br><span class="line">958,</span><br><span class="line">7,</span><br><span class="line">4555,</span><br><span class="line">5113,</span><br><span class="line">5926,</span><br><span class="line">3030,</span><br><span class="line">2805,</span><br><span class="line">6103,</span><br><span class="line">3321,</span><br><span class="line">7057,</span><br><span class="line">2739,</span><br><span class="line">2296,</span><br><span class="line">6778,</span><br><span class="line">5992,</span><br><span class="line">2412,</span><br><span class="line">5540,</span><br><span class="line">7484,</span><br><span class="line">5352,</span><br><span class="line">6431,</span><br><span class="line">2590,</span><br><span class="line">6637,</span><br><span class="line">4527,</span><br><span class="line">4162,</span><br><span class="line">5863,</span><br><span class="line">1497,</span><br><span class="line">2802,</span><br><span class="line">4281,</span><br><span class="line">4730,</span><br><span class="line">7675,</span><br><span class="line">1481,</span><br><span class="line">6999,</span><br><span class="line">6708,</span><br><span class="line">1748,</span><br><span class="line">3712,</span><br><span class="line">126,</span><br><span class="line">8111,</span><br><span class="line">8071,</span><br><span class="line">3535,</span><br><span class="line">6725,</span><br><span class="line">6717,</span><br><span class="line">2231,</span><br><span class="line">3087,</span><br><span class="line">6844,</span><br><span class="line">2080,</span><br><span class="line">7716,</span><br><span class="line">3681,</span><br><span class="line">5834,</span><br><span class="line">5903,</span><br><span class="line">5666,</span><br><span class="line">7767,</span><br><span class="line">1112,</span><br><span class="line">4696,</span><br><span class="line">4728,</span><br><span class="line">4675,</span><br><span class="line">4655,</span><br><span class="line">3456,</span><br><span class="line">5558,</span><br><span class="line">3019,</span><br><span class="line">908,</span><br><span class="line">7959,</span><br><span class="line">5845,</span><br><span class="line">2384,</span><br><span class="line">4362,</span><br><span class="line">2173,</span><br><span class="line">5657,</span><br><span class="line">604,</span><br><span class="line">7247,</span><br><span class="line">6713,</span><br><span class="line">307,</span><br><span class="line">5,</span><br><span class="line">0,</span><br><span class="line">0,</span><br><span class="line">0,</span><br><span class="line">0,</span><br><span class="line">0)</span><br><span class="line">FLAG = key_replay(reversed(a))</span><br><span class="line">print(FLAG)</span><br><span class="line">print(long_to_bytes(FLAG))</span><br><span class="line">for i in range(20):</span><br><span class="line">    print(long_to_bytes(FLAG&gt;&gt;i))</span><br></pre></td></tr></table></figure>
<p>SEKAI{7c124c1b2aebfd9e439ca1c742d26b9577924b5a1823378028c3ed59d7ad92d1}</p>

    </div>
    
    
    
    
    
    
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2024 Pr3d1ct
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;Pr3d1ct
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    




    
</body>
</html>
